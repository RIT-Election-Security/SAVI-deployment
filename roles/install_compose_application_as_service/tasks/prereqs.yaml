---
- name: Configure service to operate under user
  when: {{ use_compose_service_user }}
  block:
    - name: Create service user
      ansible.builtin.user:
        name: "{{ compose_service_name }}"
        shell: /usr/sbin/nologin
        home: "{{ compose_service_directory }}"

    - name: Grant service user ownership of repository directory
      ansible.builtin.file:
        recurse: yes
        owner: "{{ compose_service_name }}"
        group: "{{ compose_service_name }}"
